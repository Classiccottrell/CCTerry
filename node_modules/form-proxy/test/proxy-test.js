/*jslint node: true */
/*global describe, it */
"use strict";

var assert = require('assert');
var rewire = require('rewire');
var sinon = require('sinon');
var proxy = rewire('../lib/proxy');

describe('Proxy', function() {

	it('should call the proxy service with appropriate params', function(done) {

		var fakeRequest = {
     	post : function(data, cb) {
    		cb();
    	}
		};

		var post_spy = sinon.spy(fakeRequest, "post");
		proxy.__set__('request', fakeRequest);

		var data = { 
			form : { email : 'a@b.ca', name : 'john' }, 
			referer : 'http://somewebsite.tag.ga/page',
			widgetLabel : 'somelabel',
			iid : 1234
		};

		var config = {
			url : 'http://example.com:8080/widgetservices/form',
		};

		var expected = {
			url: 'http://example.com:8080/widgetservices/form',
			form: { 
				form_data: '{"email":"a@b.ca","name":"john"}',
				referer: 'http://somewebsite.tag.ga/page',
				widget_label: 'somelabel',
				iid: 1234 
			} 
		};

		proxy(data, config, function() {
			assert(post_spy.calledOnce);
			assert(post_spy.calledWith(expected));
			done();
		});

	});

});